# React最新特性对比

## React 18+ vs 旧版本主要功能差异

### 并发渲染

**旧版本**：使用同步渲染模式，一旦开始渲染就无法中断。

**新版本**：
- 引入并发渲染机制，允许React中断、暂停和恢复渲染过程
- 通过`createRoot` API代替旧的`ReactDOM.render`方法启用并发特性
```js
// 旧版本
import { render } from 'react-dom';
const container = document.getElementById('app');
render(<App tab="home" />, container);

// 新版本
import { createRoot } from 'react-dom/client';
const container = document.getElementById('app');
const root = createRoot(container);
root.render(<App tab="home" />);
```

### Suspense增强

**旧版本**：Suspense功能有限，主要用于代码分割的延迟加载。

**新版本**：
- 支持服务器端组件渲染
- 可用于数据获取
- 提供更细粒度的加载状态控制
```jsx
<Suspense fallback={<Spinner />}>
  <Comments />
</Suspense>
```

### 新增Hooks

**useTransition & useDeferredValue**

用于标记非紧急更新，允许UI保持响应：
```jsx
const [isPending, startTransition] = useTransition();
const deferredValue = useDeferredValue(value);
```

**useId**

生成唯一ID，解决服务器和客户端渲染不匹配问题：
```jsx
const id = useId();
```

**useSyncExternalStore**

更好地处理外部数据源订阅：
```jsx
const value = useSyncExternalStore(
  subscribe,
  getSnapshot,
  getServerSnapshot
);
```

**useInsertionEffect**

专为CSS-in-JS库设计的hook，在DOM更新之前执行：
```jsx
useInsertionEffect(() => {
  // 在这里注入样式
}, dependencies);
```

### React Server Components

**旧版本**：没有内置的服务器组件概念。

**新版本**：
- 引入服务器组件，可在服务器端运行并流式传输到客户端
- 减少客户端JavaScript包大小
- 提升性能和初始加载速度
- 使用`'use client'`指令区分客户端组件

### 自动批处理

**旧版本**：只在React事件处理程序内部自动批处理更新。

**新版本**：
- 扩展到所有更新场景，包括Promise、setTimeout、原生事件处理等
- 减少不必要的重渲染，提高性能

### 严格模式增强

**旧版本**：主要检查不安全的生命周期方法和其他已弃用API。

**新版本**：
- 模拟组件的卸载和重新挂载以检测副作用清理问题
- 自动检测意外的副作用
- 帮助开发者为React未来的并发特性做好准备

### View Transitions API (实验阶段)

**新版本引入**：
- 提供`unstable_ViewTransition`组件
- 支持元素跨页面的平滑动画过渡
- 改善用户体验，提供更流畅的页面切换效果

### 参考引用(Refs)改进

**旧版本**：ref回调在更新时会被调用两次。

**新版本**：
- 添加ref清理函数支持
- TypeScript类型改进，要求明确的ref回调返回值
- 更安全的ref处理机制

### 总结

React 18及以上版本带来了重大架构性变更，以并发渲染为核心，围绕性能优化和开发体验提升做了全面增强。新版React强调：

1. 更具响应性的用户界面
2. 更强大的服务器渲染能力
3. 更精细的状态更新控制
4. 更好的数据获取和加载体验
5. 更安全的副作用管理

这些变化帮助开发者构建更快、更可靠且用户体验更佳的应用程序。