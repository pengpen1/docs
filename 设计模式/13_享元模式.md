# 13_结构型：享元模式 (Flyweight)

享元模式运用共享技术有效地支持大量细粒度的对象。它通过共享不变的部分（内部状态）来减少内存消耗和提高性能。

**核心思想：**

*   将对象的状态分为内部状态（Intrinsic State）和外部状态（Extrinsic State）。
*   内部状态是对象可以共享的、不随环境改变的部分，存储在享元对象内部。
*   外部状态是对象依赖于具体场景的、不可共享的部分，由客户端在使用时传入。
*   通过一个工厂类来管理和复用享元对象。

**应用场景：**

*   一个应用程序使用了大量的对象。
*   完全由于使用大量的对象，造成很大的存储开销。
*   对象的大多数状态都可变为外部状态。
*   如果删除对象的外部状态，那么可以用相对较少的共享对象取代很多组对象。
*   应用程序不依赖于对象标识。由于 Flyweight 对象可以被共享，对于概念上明显有别的对象，标识测试将返回真值。

**结构：**

*   Flyweight（抽象享元类）：声明一个接口，通过这个接口 Flyweight 可以接受并作用于外部状态。
*   ConcreteFlyweight（具体享元类）：实现 Flyweight 接口，并为内部状态增加存储空间。ConcreteFlyweight 对象必须是可共享的。它所存储的状态必须是内部的。
*   UnsharedConcreteFlyweight（非共享具体享元类）：并非所有的 Flyweight 子类都需要被共享。Flyweight 接口使共享成为可能，但它并不强制共享。
*   FlyweightFactory（享元工厂）：创建并管理 Flyweight 对象；确保合理地共享 Flyweight。当用户请求一个 Flyweight 时，FlyweightFactory 对象提供一个已创建的实例或者创建一个（如果不存在的话）。
*   Client（客户端）：维持一个对 Flyweight 的引用；计算或存储 Flyweight 的外部状态。
